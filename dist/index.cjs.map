{"version":3,"file":"index.cjs","sources":["../src/main.ts"],"sourcesContent":["import { getInput, setFailed, info } from \"@actions/core\";\nimport fetch from \"node-fetch\";\n\nasync function run(): Promise<void> {\n  try {\n    const cacheKey = getInput(\"key\", { required: true });\n    const cacheVersion = getInput(\"version\"); // optional\n\n    const baseUrl =\n      process.env.BLACKSMITH_CACHE_URL ||\n      (process.env.PETNAME?.includes(\"staging\")\n        ? \"https://stagingapi.blacksmith.sh/cache\"\n        : \"https://api.blacksmith.sh/cache\");\n\n    const resource = cacheVersion ? `${cacheKey}/${cacheVersion}` : cacheKey;\n    const url = `${baseUrl}/${resource}`;\n\n    const response = await fetch(url, {\n      method: \"DELETE\",\n      headers: {\n        Accept: \"application/json; version=6.0-preview.1\",\n        \"X-Github-Repo-Name\": process.env[\"GITHUB_REPO_NAME\"] ?? \"\",\n        Authorization: `Bearer ${process.env[\"BLACKSMITH_CACHE_TOKEN\"]}`,\n        \"X-Cache-Region\": process.env[\"BLACKSMITH_REGION\"] ?? \"eu-central\",\n      },\n    });\n\n    if (!response.ok && response.status !== 404) {\n      throw new Error(\n        `Failed to delete cache: ${response.status} ${response.statusText}`,\n      );\n    }\n\n    if (response.status === 404) {\n      info(\n        `Cache not found: ${cacheKey}${cacheVersion ? `@${cacheVersion}` : \"\"}`,\n      );\n    } else {\n      info(\n        `Successfully deleted cache${cacheVersion ? \" version\" : \"\"}: ${cacheKey}${cacheVersion ? `@${cacheVersion}` : \"\"}`,\n      );\n    }\n  } catch (error) {\n    if (error instanceof Error) {\n      setFailed(error.message);\n    } else {\n      setFailed(\"An unexpected error occurred\");\n    }\n  }\n}\n\nrun();\n"],"names":["getInput","info","setFailed"],"mappings":";;;;;AAGA,eAAe,GAAG,GAAA;;AAChB,IAAA,IAAI;AACF,QAAA,MAAM,QAAQ,GAAGA,aAAQ,CAAC,KAAK,EAAE,EAAE,QAAQ,EAAE,IAAI,EAAE,CAAC;QACpD,MAAM,YAAY,GAAGA,aAAQ,CAAC,SAAS,CAAC,CAAC;AAEzC,QAAA,MAAM,OAAO,GACX,OAAO,CAAC,GAAG,CAAC,oBAAoB;aAC/B,CAAA,CAAA,EAAA,GAAA,OAAO,CAAC,GAAG,CAAC,OAAO,MAAE,IAAA,IAAA,EAAA,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAA,EAAA,CAAA,QAAQ,CAAC,SAAS,CAAC;AACvC,kBAAE;kBACA,iCAAiC,CAAC;AAExC,QAAA,MAAM,QAAQ,GAAG,YAAY,GAAG,CAAA,EAAG,QAAQ,CAAA,CAAA,EAAI,YAAY,CAAE,CAAA,GAAG,QAAQ;AACxE,QAAA,MAAM,GAAG,GAAG,CAAA,EAAG,OAAO,CAAI,CAAA,EAAA,QAAQ,EAAE;AAEpC,QAAA,MAAM,QAAQ,GAAG,MAAM,KAAK,CAAC,GAAG,EAAE;AAChC,YAAA,MAAM,EAAE,QAAQ;AAChB,YAAA,OAAO,EAAE;AACP,gBAAA,MAAM,EAAE,yCAAyC;gBACjD,oBAAoB,EAAE,MAAA,OAAO,CAAC,GAAG,CAAC,kBAAkB,CAAC,MAAA,IAAA,IAAA,EAAA,KAAA,KAAA,CAAA,GAAA,EAAA,GAAI,EAAE;gBAC3D,aAAa,EAAE,UAAU,OAAO,CAAC,GAAG,CAAC,wBAAwB,CAAC,CAAE,CAAA;gBAChE,gBAAgB,EAAE,MAAA,OAAO,CAAC,GAAG,CAAC,mBAAmB,CAAC,MAAA,IAAA,IAAA,EAAA,KAAA,KAAA,CAAA,GAAA,EAAA,GAAI,YAAY;AACnE,aAAA;AACF,SAAA,CAAC;QAEF,IAAI,CAAC,QAAQ,CAAC,EAAE,IAAI,QAAQ,CAAC,MAAM,KAAK,GAAG,EAAE;AAC3C,YAAA,MAAM,IAAI,KAAK,CACb,CAAA,wBAAA,EAA2B,QAAQ,CAAC,MAAM,CAAA,CAAA,EAAI,QAAQ,CAAC,UAAU,CAAA,CAAE,CACpE;;AAGH,QAAA,IAAI,QAAQ,CAAC,MAAM,KAAK,GAAG,EAAE;AAC3B,YAAAC,SAAI,CACF,CAAoB,iBAAA,EAAA,QAAQ,CAAG,EAAA,YAAY,GAAG,CAAI,CAAA,EAAA,YAAY,EAAE,GAAG,EAAE,CAAA,CAAE,CACxE;;aACI;YACLA,SAAI,CACF,CAA6B,0BAAA,EAAA,YAAY,GAAG,UAAU,GAAG,EAAE,CAAK,EAAA,EAAA,QAAQ,CAAG,EAAA,YAAY,GAAG,CAAA,CAAA,EAAI,YAAY,CAAA,CAAE,GAAG,EAAE,CAAE,CAAA,CACpH;;;IAEH,OAAO,KAAK,EAAE;AACd,QAAA,IAAI,KAAK,YAAY,KAAK,EAAE;AAC1B,YAAAC,cAAS,CAAC,KAAK,CAAC,OAAO,CAAC;;aACnB;YACLA,cAAS,CAAC,8BAA8B,CAAC;;;AAG/C;AAEA,GAAG,EAAE;;"}